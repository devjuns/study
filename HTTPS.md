# HTTPS

## HTTP란?
- Hypertext transfer protocol의 약자
- hypertext를 전송하기 위한 통신규약
    - 예) html

## HTTPS란?
- Hypertext transfer protocol secure의 약자
- HTTP보다 보안이 강화된 방식
- http는 데이터를 전송할때 암호화 되지 않은 값을 그대 전송하지만 https는 데이터를 암호화 해서 전송한다.
- http는 서버와 클라이언트가 주고받는 메시직 암호화가 되어있지 않기 때문에 이 메시지를 감청하기가 매우 쉽다.  
  하지만 https는 메시지를 암호화 해서 주고받기 때문에 감청이 불가능하다.

## SSL/TLS란?
- SSL은 넷스케이프에 의햇 발명되었고 점차 폭넓게 사용되면서 표준화 기구인 IETF의 관리로 변경되면서 TLS라는 이름으로 변경되었다.
- SSL은 Security socket layer의 약자
- TLS는 Transport layer secure의 약자
- Transport layer(TCP/IP)와 Application layer(HTTP, FTP, TELNET 등..) 사이에 존재

## SSL 동작 방법
- SSL은 공개키와 대칭키 두가지를 혼합해서 사용한다.
- 서버와 클라이언트가 데이터를 주고 받을때 실제 데이터는 대칭키를 이용해서 암호화 한다.

### 컴퓨터와 컴퓨터 네트워크를 통해서 통신을 할 때는 아래 세가지의 단계를 거친다.
1. Handshake
3. session
4. session end

### Handshake
클라이언트가 서버에게 접속한다 이 과정을 Client hello 라고 하며 이때 아래 세가지의 정보들을 서버에게 전송한다.
1. 클라이언트가 생성한 랜덤 데이터
2. 클라이언트가 지원하는 암호화 방식들
      - 클라이언트와 서버가 지원하는 암호화 방식이 다를 수 있기 때문에 서버와 어떤 암호화 방식을 사용할지 협상을 해야한다.
   이 협상을 하기 위해 서버측으로 클라이언트가 지원하는 암호화 방식들을 전송한다.
3. 세션 아이디
    - 이미 SSL Handshake에 성공했으면 비용과 시간을 절약하기 위해 기존의 세션을 재활용 하게 되는데 이 때 사용할
      연결에 대한 식별자를 서버에게 전송한다.
    
서버는 Client Hello에 대한 응답으로 Server Hello를 하게된다. 이 단계에서는 아래와 같은 정보를 주고 받는다.
1. 서버가 생성한 랜덤 데이터
2. 클라이언트가 보낸 암호화 방식들 중 서버가 선택한 방식
3. 인증서
    - 서버는 인증서에 대한 공개키와 비밀키를 갖고있다.
    - 인증서 안에는 서버가 생성한 공개키가 들어있다.
    - 클라이언트로 인증서를 보내는 시점에서 클라이언트는 해당 인증서의 공개키를 획득할 수 있다.

클라이언트는 서버가 보낸 인증서가 어떤 CA(인증기관)에 의해서 발급된 것인지를 확인하고, 
클라이언트에 내장된 CA(인증기관) 목록에 해당 CA(인증기관)이 존재하는지 확인한다.  
CA 목록에 인증서가 없다면 사용자에게 경고 메시지를 출력한다.  
인증서가 CA에 의해서 발급된 것인지를 확인하기 위해 클라이언트에 내장된 공개키로 인증서 복호화를 시도한다.  
복호화에 성공하면 해당 인증서는 CA의 개인키로 암호화된 문서임이 보증된 것이고, 클라이언트가 해당 서버를 신뢰해도 된다는 것이 증명된 것이다.

클라이언트는 서버가 보낸 **랜덤 데이터**와 자신이 생성한 **랜덤 데이터**를 조합해서 **pre master secret** 라는 키를 생성한다.  
이 키는 세션 단계에서 데이터를 주고 받을 때 암호화 하기 위해 사용된다.  
이 때 사용할 암호화 방식이 대칭키 이기 때문에 이 키는 절대로 외부에 노출이 되어서는 안된다.  
그러므로 해당 키는 암호화를 해야 하는데 이 때 서버가 보낸 인증서에 들어있는 공개키로 암호화를 한 후 서버로 전송하고,  
서버는 해당 공개키에 대한 비밀키를 가지고 있기 때문에 복호화가 가능하다.

서버는 클라이언트가 공개키로 암호화한 pre master secret 키를 받게 되고,
이 키를 자신의 비밀키로 복호화를 한다.  
이렇게 되면 서버와 클라이언트 둘 다 pre master secret 값을 공유하게 된다.

서버와 클라이언트는 일련의 과정을 거져 pre master secret을 mater secret으로 만든다.
master secret은 session key를 생성하는데, 이 session key를 이용해서 대칭키 방식으로 데이터를 암호화 해서 주고 받는다.

클라이언트와 서버는 핸드쉐이크 단계의 종료를 서로에게 알린다.

### Session
세션 단계는 클라이언트와 서버가 실제로 데이터를 주고 받는 단계이다.  
암호화 되지 않은 데이터를 주고 받을 경우에 중요한 개인정보 같은 기밀 정보들이 해커나 악의적인 사용자에게 노출이 될 수 있기 때문에
클라이언트는 session key를 이용해서 대칭키 방식으로 데이터를 암호화 하고 서버에게 전송한다.  
서버도 동일한 session key를 가지고 있으므로 해당 키로 암호화된 데이터를 복호화 할 수 있다.

공개키만 사용하는것이 아닌 공개키와 대칭키를 혼합해서 사용하는 이유는 공개키로 암호화를 할 경우 많은 컴퓨팅 파워를 사용하기 때문이다.  
공개키만 사용할 경우 서버에 많은 부하가 걸려 성능이 떨어질 수 있다.

### Session End
데이터 전송이 끝나면 SSL 통신이 끝났음을 서로에게 알려준다.  
이 때 통신에서 사용한 대칭키인 session key를 폐기한다.
